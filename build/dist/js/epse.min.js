var Utils,ECS,EPSE,__extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e=function(t){this.name=t};(ECS||(ECS={})).Component=e}(),function(t){var e=function(){function t(){this.items={}}return t.prototype.set=function(t,e){this.items[t]=e},t.prototype.delete=function(t){return delete this.items[t]},t.prototype.has=function(t){return t in this.items},t.prototype.get=function(t){return this.items[t]},t.prototype.len=function(){return Object.keys(this.items).length},t.prototype.forEach=function(t){for(var e in this.items)t(e,this.items[e])},t.prototype.forEach2=function(t){for(var e in this.items)return t(e,this.items[e]),this.items[e]},t}();t.HashSet=e}(Utils||(Utils={})),function(t){var e=function(){function t(t){this.count=0,this.name=t,this.id=(+new Date).toString(16)+(1e8*Math.random()|0).toString(16)+this.count,this.count++,this.components=new Utils.HashSet}return t.prototype.addComponent=function(t){return this.components.set(t.name,t),t},t.prototype.removeComponent=function(t){var e=t.name;return!!this.components.delete(e)},t}();t.Entity=e}(ECS||(ECS={})),function(t){var e=function(e){function t(){var t=e.call(this,"boundingbox")||this;return t.boundingBox={visible:!1,color:null,opacity:.2,transparent:!0,draggFlag:!1},t}return __extends(t,e),t}(ECS.Component);t.EBoundingBoxComponent=e}(EPSE||(EPSE={})),function(t){var e=function(e){function t(){var t=e.call(this,"geometry")||this;return t.getGeometry=function(t,e){if(e=e||{},"Sphere"===(t=t||this.geometry.type))var i=new THREE.SphereGeometry(e.radius||this.geometry.radius,e.widthSegments||this.geometry.widthSegments,e.heightSegments||this.geometry.heightSegments,e.phiStart||this.geometry.phiStart,e.phiLength||this.geometry.phiLength,e.thetaStart||this.geometry.thetaStart,e.thetaLength||this.geometry.thetaLength);else if("Plane"===t)i=new THREE.PlaneGeometry(e.width||this.geometry.width,e.height||this.geometry.height,e.widthSegments||this.geometry.widthSegments,e.heightSegments||this.geometry.heightSegments);else if("Cube"===t)i=new THREE.CubeGeometry(e.width||this.geometry.width,e.depth||this.geometry.depth,e.height||this.geometry.height,e.widthSegments||this.geometry.widthSegments,e.heightSegments||this.geometry.heightSegments,e.depthSegments||this.geometry.depthSegments);else if("Circle"===t)i=new THREE.CircleGeometry(e.radius||this.geometry.radius,e.segments||this.geometry.segments,e.thetaStart||this.geometry.thetaStart,e.thetaLength||this.geometry.thetaLength);else if("Cylinder"===t)i=new THREE.CylinderGeometry(e.radiusTop||this.geometry.radiusTop,e.radiusBottom||this.geometry.radiusBottom,e.height||this.geometry.height,e.radialSegments||this.geometry.radialSegments,e.heightSegments||this.geometry.heightSegments,e.openEnded||this.geometry.openEnded);else alert("形状オブジェクトの設定ミス");return i},t.geometry={type:null},t}return __extends(t,e),t}(ECS.Component);t.EGeometryComponent=e}(EPSE||(EPSE={})),function(t){var e=function(e){function t(){var t=e.call(this,"locus")||this;return t.locus={enabled:!1,visible:!1,color:null,maxNum:1e3},t}return __extends(t,e),t}(ECS.Component);t.ELocusComponent=e}(EPSE||(EPSE={})),function(t){var e=function(e){function t(){var t=e.call(this,"material")||this;return t.material={type:"Lambert",shading:"Flat",side:"Front",color:16711680,ambient:10027008,opacity:1,transparent:!1,emissive:0,specular:1118481,shininess:30,castShadow:!1,receiveShadow:!1},t}return __extends(t,e),t.prototype.getMaterial=function(t,e){t=t||this.material.type;var i={color:this.material.color,ambient:this.material.ambient,transparent:this.material.transparent,opacity:this.material.opacity,emissive:this.material.emissive,specular:this.material.specular,shininess:this.material.shininess,side:this.material.side,shading:this.material.shading};if("Front"===i.side?i.side=THREE.FrontSide:"Double"===i.side?i.side=THREE.DoubleSide:"Back"===i.side?i.side=THREE.BackSide:alert("描画面指定ミス"),"Flat"===i.shading?i.shading=THREE.FlatShading:"Smooth"===i.shading?i.shading=THREE.SmoothShading:alert("シェーディング指定ミス"),"Lambert"===t)var s=new THREE.MeshLambertMaterial(i);else if("Phong"===t)s=new THREE.MeshPhongMaterial(i);else if("Basic"===t)s=new THREE.MeshBasicMaterial(i);else if("Normal"===t)s=new THREE.MeshNormalMaterial(i);else alert("材質オブジェクト指定ミス");return s},t}(ECS.Component);t.EMaterialComponent=e}(EPSE||(EPSE={})),function(t){var e=function(e){function t(){var t=e.call(this,"velocityvector")||this;return t.velocityVector={enabled:!1,visible:!1,color:null,scale:.5},t}return __extends(t,e),t}(ECS.Component);t.EVelocityVectorComponent=e}(EPSE||(EPSE={})),function(t){t.g=9.8,t.delta_t=.001,t.skipRendering=40,t.pauseFlag=!0,t.locusFlag="true",t.velocityVectorFlag="pause",t.boundingBoxFlag="dragg"}(EPSE||(EPSE={})),function(r){var t=function(e){function t(){var t=e.call(this,"physics")||this;return t.step=0,t.r=new THREE.Vector3,t.v=new THREE.Vector3,t.a=new THREE.Vector3,t.e=1,t.mass=1,t.r_1=new THREE.Vector3,t.r_2=new THREE.Vector3,t.recordData=!1,t.dynamic=!1,t.skipRecord=100,t.data={},t.data.x=[],t.data.y=[],t.data.z=[],t.data.vx=[],t.data.vy=[],t.data.vz=[],t.data.kinetic=[],t.data.potential=[],t.data.energy=[],t}return __extends(t,e),t.prototype.getForce=function(){return new THREE.Vector3(0,0,-this.mass*r.g)},t.prototype.getEnergy=function(){var t=this.v.lengthSq(),e=.5*this.mass*t,i=0===this.step?this.r.z:this.r_1.z;return{kinetic:e,potential:this.mass*r.g*i}},t.prototype.timeEvolution=function(){this.step++;var t=r.delta_t,e=this.getForce();this.a.x=e.x/this.mass,this.a.y=e.y/this.mass,this.a.z=e.z/this.mass,this.computeTimeEvolution(t),this.recordDynamicData()},t.prototype.computeInitialCondition=function(){var t=r.delta_t,e=this.getForce();this.a=e.clone().divideScalar(this.mass),this.r_1.x=this.r.x-this.v.x*t+.5*this.a.x*t*t,this.r_1.y=this.r.y-this.v.y*t+.5*this.a.y*t*t,this.r_1.z=this.r.z-this.v.z*t+.5*this.a.z*t*t},t.prototype.computeTimeEvolution=function(t){var e=this.r.x,i=this.r.y,s=this.r.z;this.r.x=2*this.r.x-this.r_1.x+this.a.x*t*t,this.r.y=2*this.r.y-this.r_1.y+this.a.y*t*t,this.r.z=2*this.r.z-this.r_1.z+this.a.z*t*t,this.v.x=(this.r.x-this.r_1.x)/(2*t),this.v.y=(this.r.y-this.r_1.y)/(2*t),this.v.z=(this.r.z-this.r_1.z)/(2*t),this.r_2.x=this.r_1.x,this.r_2.y=this.r_1.y,this.r_2.z=this.r_1.z,this.r_1.x=e,this.r_1.y=i,this.r_1.z=s},t.prototype.initDynamicData=function(){this.data.x=[],this.data.y=[],this.data.z=[],this.data.vx=[],this.data.vy=[],this.data.vz=[],this.data.kinetic=[],this.data.potential=[],this.data.energy=[]},t.prototype.recordDynamicData=function(){if(this.recordData&&(0==this.step||this.step/this.skipRecord>this.data.x.length)){var t,e,i,s;s=0!=this.step&&this.dynamic?(t=this.step-1,e=this.r_1.x,i=this.r_1.y,this.r_1.z):(t=this.step,e=this.r.x,i=this.r.y,this.r.z);var n=t*r.delta_t;this.data.x.push([n,e]),this.data.y.push([n,i]),this.data.z.push([n,s]),this.data.vx.push([n,this.v.x]),this.data.vy.push([n,this.v.y]),this.data.vz.push([n,this.v.z]);var o=this.getEnergy();this.data.kinetic.push([n,o.kinetic]),this.data.potential.push([n,o.potential]),this.data.energy.push([n,o.kinetic+o.potential])}},t}(ECS.Component);r.EPhysComponent=t}(EPSE||(EPSE={})),function(r){var t=function(e){function t(){var t=e.call(this,"physics_object")||this;return t.c_physics=t.addComponent(new r.EPhysComponent),t.c_boundingBox=t.addComponent(new r.EBoundingBoxComponent),t.c_geometry=t.addComponent(new r.EGeometryComponent),t.c_locus=t.addComponent(new r.ELocusComponent),t.c_material=t.addComponent(new r.EMaterialComponent),t.c_velocityVector=t.addComponent(new r.EVelocityVectorComponent),t.visible=!0,t.draggable=!1,t.allowDrag=!1,t.CG={},t}return __extends(t,e),t.prototype.create3DCG=function(){var t=this.c_geometry.getGeometry(),e=this.c_material.getMaterial(),i=this.c_boundingBox.boundingBox;if(this.CG=new THREE.Mesh(t,e),this.draggable){this.CG.geometry.computeBoundingBox(),i.width=(new THREE.Vector3).subVectors(this.CG.geometry.boundingBox.max,this.CG.geometry.boundingBox.min);t=new THREE.CubeGeometry(i.width.x,i.width.y,i.width.z),e=new THREE.MeshBasicMaterial({color:i.color,transparent:i.transparent,opacity:i.opacity});i.CG=new THREE.Mesh(t,e),i.center=(new THREE.Vector3).addVectors(this.CG.geometry.boundingBox.max,this.CG.geometry.boundingBox.min).divideScalar(2),i.CG.position.copy(this.c_physics.r).add(i.center),i.CG.visible=i.visible,i.CG.physObject=this}},t.prototype.create=function(){this.create3DCG();var t=this.c_material.material,e=this.c_velocityVector.velocityVector,i=this.c_locus.locus;if(this.CG.castShadow=t.castShadow,this.CG.receiveShadow=t.receiveShadow,e.enabled&&(e.CG=new THREE.ArrowHelper(this.c_physics.v.clone().normalize(),this.c_physics.r.clone(),1,e.color)),i.enabled){var s=new THREE.BufferGeometry;s.attributes={position:{itemSize:3,array:new Float32Array(3*i.maxNum),numItems:3*i.maxNum,dynamic:!0}};t=new THREE.LineBasicMaterial({color:i.color});i.CG=new THREE.Line(s,t)}this.c_physics.recordDynamicData(),this.c_physics.computeInitialCondition()},t.prototype.update=function(){this.CG.position=this.c_physics.r.clone(),this.CG.visible=this.visible;for(var t=0;t<this.CG.children.length;t++)this.CG.children[t].visible=this.visible;this.updateLocus(),this.updateVelocityVector(),this.updateBoundingBox()},t.prototype.updateLocus=function(t){var e=this.c_locus.locus;if(e.enabled){t=void 0!==t?t:e.color;for(var i=this.c_physics.data.x.length-1,s=e.CG.geometry.attributes.position.array.length/3,n=i;n<s;n++)e.CG.geometry.attributes.position.array[3*n]=this.c_physics.r.x,e.CG.geometry.attributes.position.array[3*n+1]=this.c_physics.r.y,e.CG.geometry.attributes.position.array[3*n+2]=this.c_physics.r.z;e.CG.geometry.attributes.position.needsUpdate=!0,e.CG.material.color.setHex(t);var o=!1;"true"==r.locusFlag?o=!0:"false"==r.locusFlag?o=!1:"pause"==r.locusFlag&&(o=!!r.pauseFlag),e.CG.visible=o&&e.visible}},t.prototype.updateVelocityVector=function(t,e){var i=this.c_velocityVector.velocityVector;if(i.enabled){t=void 0!==t?t:i.color,e=void 0!==e?e:i.scale;var s=this.c_physics.v.length()*e;s<.01&&(e=s=.01),i.CG.setDirection(this.c_physics.v.clone().normalize()),i.CG.setLength(s,e,e),i.CG.position=this.c_physics.r.clone(),i.CG.setColor(t);var n=!1;"true"==r.velocityVectorFlag?n=!0:"false"==r.velocityVectorFlag?n=!1:"pause"==r.velocityVectorFlag&&(n=!!r.pauseFlag);for(var o=0;o<i.CG.children.length;o++)i.CG.children[o].visible=n&&i.visible}},t.prototype.updateBoundingBox=function(){if(this.draggable){var t=this.c_boundingBox.boundingBox;t.CG.position.copy(this.c_physics.r).add(t.center);var e=!1;"true"==r.boundingBoxFlag?e=!0:"false"==r.boundingBoxFlag?e=!1:"dragg"==r.boundingBoxFlag&&(e=!!t.draggFlag),t.CG.visible=e&&t.visible,this.c_physics.dynamic||(this.c_physics.v=(new THREE.Vector3).subVectors(this.c_physics.r,this.c_physics.r_1).divideScalar(r.delta_t*r.skipRendering),this.c_physics.r_1.copy(this.c_physics.r))}},t}(ECS.Entity);r.EPhysEntity=t}(EPSE||(EPSE={})),function(t){var e=function(i){function t(){var t=i.call(this)||this;t.name="sphere",t.radius=1;var e=t.c_geometry.geometry;return t.c_material.material.shading="Smooth",e.type="Sphere",e.radius=t.radius,e.widthSegments=20,e.heightSegments=20,e.phiStart=0,e.phiLength=2*Math.PI,e.thetaStart=0,e.thetaLength=Math.PI,t}return __extends(t,i),t}(t.EPhysEntity);t.EPhysSphere=e}(EPSE||(EPSE={}));var sphere=new EPSE.EPhysSphere;console.log(sphere);